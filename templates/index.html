<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bai+Jamjuree:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&family=Commissioner:wght@100..900&family=Fraunces:ital,opsz,wght@0,9..144,100..900;1,9..144,100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Quicksand:wght@300..700&family=Sansita+Swashed:wght@300..900&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>

    <title>ReCircle Campus</title>
</head>
<body>
        <nav class="nav-bar nav-container">
            <a href="{{ url_for('home') }}">
                <img src="static/images/dark background brand colour and lemon green logo 1.png" alt="" >
            </a>

            <ul class="nav-menu">
                <li class="nav-item"><a href="#home" class="nav-link">Home</a></li>
                <li class="nav-item"><a href="#about" class="nav-link">About Us</a></li>
                <li class="nav-item"><a href="{{ url_for('brands') }}" class="nav-link">For Brands</a></li>
                <li class="nav-item"><a href="#bookCall"  class="nav-link" onclick="Calendly.initPopupWidget({ url: 'https://calendly.com/benedictanwachukwu456' }); return false;">Book call</a></li>
            </ul>

            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </nav>


    <section id="home" class="hero">
        <div class="content">
            <h1> <span class="gradient">ReCircle Campus </span> is where students save money, cut waste, buy and sell quality College essentials, student to student</h1>
            <p>We're building a zero-waste, peer-to-peer marketplace where students buy, sell and exchange books, clothes, gadgets and more safely, affordably and sustainably all through local campus pick-up zones</p>
                <form class="subscribe" action="{{ url_for('join_waitlist') }}" method="POST">
                   <input type="email"  name="email" placeholder="name@gmail.com" required>
                    <button type="submit">join waitlist</button>
                </form>

            {% with messages = get_flashed_messages(with_categories= true) %}
                    {% if messages %}
                        <ul>
                            {% for category, message in messages %}
                                <li class="flash {{ category }}">{{ message }}</li>
                            {% endfor %}
                        </ul>

                    {% endif %}
            {% endwith %}
        </div>
    </section>


    <section id="whyUs" class="mission section" data-aos="fade-up" >
        <h1>Why students love us</h1>
        <div class="container">
            <div class="card section" data-aos="fade-up">
                <img src="static/images/isometric-money-background.png" alt="">
                <h2>Affordable and Student-Friendly</h2>
                <p>We make everyday essentials cheaper with resale and student-only discounts. No hidden costs, no delivery stress, just simple, fair proces. Students save money while till getting what they need.</p>
            </div>
            <div class="card section" data-aos="fade-up">
                <img src="static/images/2.png" alt="" class="safe">
                <h2>Safe and Easy to Use</h2>
                <p>Local campus pick-up zones mean no scams or risky meet-ups. Everything happens where students already are, right on campus. buy, sell and swap in a safe and familiar environment.</p>
            </div>
            <div class="card section" data-aos="fade-up">
                <img src="static/images/trashs.png" alt="">
                <h2>Good for you, Good for the planet</h2>
                <p>By reusing and reselling, students cut down on campus waste. Every transaction helps reduce carbon and promotes eco-conscious living. It feels good to save money and do something positive for the planet.</p>
            </div>
        </div>
    </section>



    <section id="about" class="section" data-aos="fade-up">
        <div class="text">
            <h1>About Us</h1>
            <p>
                University life is expensive, but it does not have to be,
                ReCircle campus is your go-to student marketplace where you can find affordable deals and give your old stuff a new home.
            </p>

            <p>We are  building a culture of  making, saving and supporting each other on Campus.</p>

            <p>We also partner with retailers, malls and brands to bring students exclusive discounts and clearance stock, giving them
               direct access to the student market while promoting a culture of reuse. Together, we are shaping the future of a sustainable student economy.
            </p>

            <p>ReCircle Campus is creating a sustainable student economy, making life easier, more affordable, and environmentally friendly for students.</p>
        </div>
    </section>





    <section class="cont section" data-aos="fade-up" >
        <h2>How does ReCircle campus benefit students</h2>

        <div class="benefit">
            <div class="benefit-card section" data-aos="fade-up">
                <h3>Convenient marketplace</h3>
                <p>ReCircle Campus provides a campus-based marketplace where students can easily buy and sell items, saving  time and effort.</p>
            </div>

            <div class="benefit-card section" data-aos="fade-up">
                <h3>Sustainable Living</h3>
                <p>By promoting reuse and recycling, ReCircle Campus encourages sustainable living and reduces waste on campus.</p>
            </div>

            <div class="benefit-card section" data-aos="fade-up">
                <h3>Affordability</h3>
                <p>The platform offers discounts and affordable prices, making it easier for students to access the items they need</p>
            </div>
            <div class="benefit-card section" data-aos="fade-up">
                <h3>Opportunity to declutter and earn</h3>
                <p>Students can declutter their spaces and earn money by selling items they no longer need</p>
            </div>
            <div class="benefit-card section" data-aos="fade-up">
                <h3>Access to brands and retailers</h3>
                <p>ReCircle Campus connects students with forward-thinking brands and retailer, providing exclusive discounts and promotions</p>
            </div>
            <div class="benefit-card section" data-aos="fade-up">
                <h3>Students safety</h3>
                <p>At ReCircle Campus, safety comes firs. Every buyer and seller is part of a verified campus community, which helps create a trusted environment.</p>
            </div>
        </div>

    </section>



    <section id="bookCall" class="bookcall section" data-aos="fade-up" >
        <div>
            <p> <span>ALL USERS</span>  sign up with  their campus email, so you know you are dealing with students only</p>
            <p>Take the hassle off your plate...want to know more?</p>
            {% raw %}
                <button onclick="Calendly.initPopupWidget({ url: 'https://calendly.com/benedictanwachukwu456' }); return false;">Book a Call</button>
            {% endraw %}
        </div>
    </section>




    <footer>
            <div>
                <figure class="logotext">
                    <img src="static/images/dark brand colour and lemon green logo.png" alt="" class="logo">
                </figure>
                <p>Copyright <img src="static/images/copyright.png" class="copyright"> 2025 ReCircle Campus Ventures.</p>
                <p>All rights reserved</p>

                <div>
                    <a href="https://www.instagram.com/recirclecampus">
                       <img src="/static/images/instagram.png" alt="" class="icon-img">
                    </a>
                    <a href="https://www.facebook.com/recirclecampus">
                        <img src="/static/images/facebook.png" alt="" class="icon-img">
                    </a>
                    <a href="https://www.linkedin.com/company/recircle-campus">
                        <img src="/static/images/linkedin.png" alt="" class="icon-img">
                    </a>
                </div>
            </div>

            <div>
                <div class="foot">
                    <p>Company</p>
                    <ul class="footerlink">
                        <li><a href="#about">About us</a></li>
                        <li> <a href="{{ url_for('terms') }}">Terms of services</a></li>
                        <li> <a href="{{ url_for('policy') }}">Privacy policy</a></li>
                        <li> <a href="">Contact us</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-btn">
                <p>Stay up to date</p>
                <input type="email" placeholder="johndoe@gmail.com">
                <button>Join waitlist</button>
            </div>
    </footer>

     <button id="chatbot-toggler">
        <span class="material-symbols-rounded">mode_comment</span>
        <span class="material-symbols-rounded">close</span>
    </button>

    <div class="chatbot-popup">
        <!-- chat bot header -->
        <div class="chat-header">
            <div class="header-info">
                <svg class="chatbot-logo bot-avatar" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 1024 1024">
                    <path d="M738.3 287.6H285.7c-59 0-106.8 47.8-106.8 106.8v303.1c0 59 47.8 106.8 106.8 106.8h81.5v111.1c0 .7.8 1.1 1.4.7l166.9-110.6 41.8-.8h117.4l43.6-.4c59 0 106.8-47.8 106.8-106.8V394.5c0-59-47.8-106.9-106.8-106.9zM351.7 448.2c0-29.5 23.9-53.5 53.5-53.5s53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5-53.5-23.9-53.5-53.5zm157.9 267.1c-67.8 0-123.8-47.5-132.3-109h264.6c-8.6 61.5-64.5 109-132.3 109zm110-213.7c-29.5 0-53.5-23.9-53.5-53.5s23.9-53.5 53.5-53.5 53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5zM867.2 644.5V453.1h26.5c19.4 0 35.1 15.7 35.1 35.1v121.1c0 19.4-15.7 35.1-35.1 35.1h-26.5zM95.2 609.4V488.2c0-19.4 15.7-35.1 35.1-35.1h26.5v191.3h-26.5c-19.4 0-35.1-15.7-35.1-35.1zM561.5 149.6c0 23.4-15.6 43.3-36.9 49.7v44.9h-30v-44.9c-21.4-6.5-36.9-26.3-36.9-49.7 0-28.6 23.3-51.9 51.9-51.9s51.9 23.3 51.9 51.9z"></path>
                </svg>
                <h2 class="logo-text">Chatbot</h2>
            </div>
            <button class="material-symbols-rounded" id="close-chatbot">keyboard_arrow_down</button>
        </div>

        <!-- Chatbot body -->
        <div class="chat-body">
            <div class="message bot-message">
                <svg class="bot-avatar" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 1024 1024">
                    <path d="M738.3 287.6H285.7c-59 0-106.8 47.8-106.8 106.8v303.1c0 59 47.8 106.8 106.8 106.8h81.5v111.1c0 .7.8 1.1 1.4.7l166.9-110.6 41.8-.8h117.4l43.6-.4c59 0 106.8-47.8 106.8-106.8V394.5c0-59-47.8-106.9-106.8-106.9zM351.7 448.2c0-29.5 23.9-53.5 53.5-53.5s53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5-53.5-23.9-53.5-53.5zm157.9 267.1c-67.8 0-123.8-47.5-132.3-109h264.6c-8.6 61.5-64.5 109-132.3 109zm110-213.7c-29.5 0-53.5-23.9-53.5-53.5s23.9-53.5 53.5-53.5 53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5zM867.2 644.5V453.1h26.5c19.4 0 35.1 15.7 35.1 35.1v121.1c0 19.4-15.7 35.1-35.1 35.1h-26.5zM95.2 609.4V488.2c0-19.4 15.7-35.1 35.1-35.1h26.5v191.3h-26.5c-19.4 0-35.1-15.7-35.1-35.1zM561.5 149.6c0 23.4-15.6 43.3-36.9 49.7v44.9h-30v-44.9c-21.4-6.5-36.9-26.3-36.9-49.7 0-28.6 23.3-51.9 51.9-51.9s51.9 23.3 51.9 51.9z"></path>
                </svg>
                <div class="message-text">Hey there. <br> How can I help you today?</div>
            </div>
        </div>

        <!-- Chatbot footer -->
         <div class="chat-footer">
            <form action="" class="chat-form">
                <textarea placeholder="Message..." class="message-input" required></textarea>
                <div class="chat-controls">
                  <button type="button" class="material-symbols-rounded close-chatbot">sentiment_satisfied</button>
                  <div class="file-upload-wrapper">
                    <input type="file" accept="images/" id="file-input" hidden>
                    <img src="#">
                    <button type="button" id="file-upload" class="material-symbols-rounded" class="close-chatbot">attach_file</button>
                    <button type="button" id="file-cancel" class="material-symbols-rounded" class="close-chatbot">close</button>
                  </div>
                  <button type="button" class="material-symbols-rounded send-message" class="close-chatbot" onclick="sendAcross()" >arrow_upward</button>
                </div>
            </form>
         </div>
    </div>


    <script src="{{ url_for('static', filename='js/app.js') }}"></script>


    <script>
        // hamburger
        const hamburger = document.querySelector('.hamburger');
        const navMenu = document.querySelector('.nav-menu');

        hamburger.addEventListener('click', () =>{
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
        })
        document.querySelectorAll('.nav-link').forEach(n => n.addEventListener('click', () => {
            hamburger.classList.remove('active');
            navMenu.classList.remove('active');
        }));

        // navbar
        window.addEventListener('scroll', function(){
            const navbar = document.querySelector('.nav-bar');
            const scrolled = window.pageYOffset;

            if (scrolled > 50) {
                navbar.classList.add('scrolled');
            }else{
                navbar.classList.remove('scrolled');
            }
        })

        //scrolled
        AOS.init({
            duration: 800,
        });

        window.addEventListener("scroll", function(){
            const navbar = document.querySelector(".nav-bar");
            navbar.classList.toggle("scrolled",window.scrollY>50);
        });

        //typewriter
        const text = "We're building a zero-waste, peer-to-peer marketplace where students buy, sell and exchange books, clothes, gadgets and more safely, affordably and sustainably all through local campus pick-up zones";   // the phrase
        const typewriter = document.querySelector(".typeWriter");
        let i = 0;  // which letter we are on

        function type() {
            if (i < text.length) {
            typewriter.textContent += text.charAt(i); // add one letter
            i++;
            setTimeout(type, 50); // typing speed (100ms per letter)
            }
        }

        type();


        const chatBody = document.querySelector('.chat-body');
        const messageInput = document.querySelector('.message-input');
        const sendMessageButton = document.querySelector('.send-message');
        const fileInput = document.querySelector('#file-input');
        const fileUploadWrapper = document.querySelector(".file-upload-wrapper");
        const fileCancelButton = document.querySelector("#file-cancel");
        const chatbotToggler = document.querySelector('#chatbot-toggler');
        const closeChatbot = document.querySelector('#close-chatbot');

        // Flask backend URL
        const BACKEND_URL = "http://127.0.0.1:5000";

        const userData = {
            message: null,
            file: {
                data: null,
                mime_type: null
            }
        };

        const initialInputHeight = messageInput.scrollHeight;

        // Create message element with dynamic classes and return it
        const createMessageElement = (content, ...classes) => {
            const div = document.createElement("div");
            div.classList.add("message", ...classes);
            div.innerHTML = content;
            return div;
        }

        // Generate bot response by fetching from Telegram via Flask
        const generateBotResponse = async (incomingMessageDiv) => {
            const messageElement = incomingMessageDiv.querySelector(".message-text");

            try {
                // Wait for Telegram response (poll every 1 second for up to 30 seconds)
                let attempts = 0;
                let maxAttempts = 30;  // Increased from 10 to 30 seconds
                let responseReceived = false;

                while (attempts < maxAttempts && !responseReceived) {
                    await new Promise(resolve => setTimeout(resolve, 1000));

                    try {
                        const response = await fetch(`${BACKEND_URL}/get_response`);

                        // Check if response is JSON
                        const contentType = response.headers.get("content-type");
                        if (!contentType || !contentType.includes("application/json")) {
                            console.error("Received non-JSON response");
                            attempts++;
                            continue;
                        }

                        const data = await response.json();

                        if (data.success && data.response) {
                            const apiResponseText = data.response.trim();
                            messageElement.innerText = apiResponseText;
                            responseReceived = true;
                        }
                    } catch (fetchError) {
                        console.error("Fetch attempt failed:", fetchError);
                        // Continue trying
                    }

                    attempts++;
                }

                if (!responseReceived) {
                    messageElement.innerText = "No response received. Please check if you replied in Telegram.";
                    messageElement.style.color = "#ff6b6b";
                }

            } catch (error) {
                console.log(error);
                messageElement.innerText = "Error: " + error.message;
                messageElement.style.color = "#ff0000";
            } finally {
                userData.file = {};
                incomingMessageDiv.classList.remove("thinking");
                chatBody.scrollTo({top: chatBody.scrollHeight, behavior: "smooth"});
            }
        }

        // Send message to Flask backend
        const sendMessageToBackend = async (message) => {
            try {
                const response = await fetch(`${BACKEND_URL}/send_message`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({message: message})
                });

                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error(data.error || "Failed to send message");
                }

                return true;
            } catch (error) {
                console.error("Error sending message:", error);
                throw error;
            }
        }

        const handleOutgoingMessage = async (e) => {
            e.preventDefault();

            userData.message = messageInput.value.trim();
            if (!userData.message) return;

            const currentMessage = userData.message;
            messageInput.value = "";
            fileUploadWrapper.classList.remove("file-uploaded");
            messageInput.dispatchEvent(new Event("input"));

            // Display user message
            const messageContent = `<div class="message-text"></div> ${userData.file.data ? `<img src="data:${userData.file.mime_type};base64,${userData.file.data}" class="attachment" />` : ""}`;
            const outgoingMessageDiv = createMessageElement(messageContent, "user-message");
            outgoingMessageDiv.querySelector('.message-text').innerText = currentMessage;
            chatBody.appendChild(outgoingMessageDiv);
            chatBody.scrollTo({top: chatBody.scrollHeight, behavior: "smooth"});

            // Send to backend
            try {
                await sendMessageToBackend(currentMessage);

                // Show bot thinking indicator
                setTimeout(() => {
                    const messageContent = `<svg class="bot-avatar" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 1024 1024">
                                <path d="M738.3 287.6H285.7c-59 0-106.8 47.8-106.8 106.8v303.1c0 59 47.8 106.8 106.8 106.8h81.5v111.1c0 .7.8 1.1 1.4.7l166.9-110.6 41.8-.8h117.4l43.6-.4c59 0 106.8-47.8 106.8-106.8V394.5c0-59-47.8-106.9-106.8-106.9zM351.7 448.2c0-29.5 23.9-53.5 53.5-53.5s53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5-53.5-23.9-53.5-53.5zm157.9 267.1c-67.8 0-123.8-47.5-132.3-109h264.6c-8.6 61.5-64.5 109-132.3 109zm110-213.7c-29.5 0-53.5-23.9-53.5-53.5s23.9-53.5 53.5-53.5 53.5 23.9 53.5 53.5-23.9 53.5-53.5 53.5zM867.2 644.5V453.1h26.5c19.4 0 35.1 15.7 35.1 35.1v121.1c0 19.4-15.7 35.1-35.1 35.1h-26.5zM95.2 609.4V488.2c0-19.4 15.7-35.1 35.1-35.1h26.5v191.3h-26.5c-19.4 0-35.1-15.7-35.1-35.1zM561.5 149.6c0 23.4-15.6 43.3-36.9 49.7v44.9h-30v-44.9c-21.4-6.5-36.9-26.3-36.9-49.7 0-28.6 23.3-51.9 51.9-51.9s51.9 23.3 51.9 51.9z"></path>
                            </svg>
                            <div class="message-text">
                                <div class="thinking-indicator">
                                    <div class="dot"></div>
                                    <div class="dot"></div>
                                    <div class="dot"></div>
                                </div>
                            </div>`;
                    const incomingMessageDiv = createMessageElement(messageContent, "bot-message", "thinking");
                    chatBody.appendChild(incomingMessageDiv);
                    chatBody.scrollTo({top: chatBody.scrollHeight, behavior: "smooth"});
                    generateBotResponse(incomingMessageDiv);
                }, 600);

            } catch (error) {
                alert("Failed to send message: " + error.message);
            }
        }

        // Handle enter key for sending messages
        messageInput.addEventListener('keydown', (e) => {
            const userMessage = e.target.value.trim();
            if (e.key === "Enter" && userMessage && !e.shiftKey && window.innerWidth > 768) {
                handleOutgoingMessage(e);
            }
        });

        messageInput.addEventListener("input", () => {
            messageInput.style.height = `${initialInputHeight}px`;
            messageInput.style.height = `${messageInput.scrollHeight}px`;
            document.querySelector(".chat-form").style.borderRadius = messageInput.scrollHeight > initialInputHeight ? "15px" : "33px";
        });

        fileInput.addEventListener("change", () => {
            const file = fileInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                fileUploadWrapper.querySelector("img").src = e.target.result;
                fileUploadWrapper.classList.add("file-uploaded");
                const base64String = e.target.result.split(",")[1];

                userData.file = {
                    data: base64String,
                    mime_type: file.type
                };

                fileInput.value = "";
            };

            reader.readAsDataURL(file);
        });

        fileCancelButton.addEventListener("click", () => {
            userData.file = {};
            fileUploadWrapper.classList.remove("file-uploaded");
        });

        sendMessageButton.addEventListener('click', (e) => handleOutgoingMessage(e));
        document.querySelector("#file-upload").addEventListener("click", () => fileInput.click());
        chatbotToggler.addEventListener("click", () => document.body.classList.toggle("show-chatbot"));
        closeChatbot.addEventListener("click", () => document.body.classList.remove('show-chatbot'));
    </script>
</body>
</html>
